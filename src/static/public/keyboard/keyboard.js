!function(e,i){"function"==typeof define&&define.amd?define(["jquery"],i):e.securityKeyboard=i(jQuery)}(this,function(g){var s,t,p,o=16,m=o,w=65536,N=w>>>1,C=w*w,x=w-1;function n(e){s=new Array(e);for(var i=0;i<s.length;i++)s[i]=0;t=new A,(p=new A).digits[0]=1}n(20);e(1e15);function A(e){this.digits="boolean"==typeof e&&1==e?null:s.slice(0),this.isNeg=!1}function T(e){var i=new A(!0);return i.digits=e.digits.slice(0),i.isNeg=e.isNeg,i}function e(e){var i=new A;i.isNeg=e<0,e=Math.abs(e);for(var s=0;0<e;)i.digits[s++]=e&x,e=Math.floor(e/w);return i}function d(e){for(var i="",s=e.length-1;-1<s;--s)i+=e.charAt(s);return i}var c=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");function v(e,i){var s=new A;s.digits[0]=i;for(var r=K(e,s),a=c[r[1].digits[0]];1==L(r[0],t);)r=K(r[0],s),digit=r[1].digits[0],a+=c[r[1].digits[0]];return(e.isNeg?"-":"")+d(a)}var r=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");function a(e){var s="";for(i=0;i<4;++i)s+=r[15&e],e>>>=4;return d(s)}function l(e){for(var i="",s=(O(e),O(e));-1<s;--s)i+=a(e.digits[s]);return i}function y(e){return 48<=e&&e<=57?e-48:65<=e&&e<=90?10+e-65:97<=e&&e<=122?10+e-97:0}function u(e){for(var i=0,s=Math.min(e.length,4),r=0;r<s;++r)i<<=4,i|=y(e.charCodeAt(r));return i}function k(e){for(var i=new A,s=e.length,r=0;0<s;s-=4,++r)i.digits[r]=u(e.substr(Math.max(s-4,0),Math.min(s,4)));return i}function M(e,i){var s;if(e.isNeg!=i.isNeg)i.isNeg=!i.isNeg,s=I(e,i),i.isNeg=!i.isNeg;else{s=new A;for(var r,a=0,t=0;t<e.digits.length;++t)r=e.digits[t]+i.digits[t]+a,s.digits[t]=r%w,a=Number(w<=r);s.isNeg=e.isNeg}return s}function I(e,i){var s;if(e.isNeg!=i.isNeg)i.isNeg=!i.isNeg,s=M(e,i),i.isNeg=!i.isNeg;else{var r,a;s=new A;for(var t=a=0;t<e.digits.length;++t)r=e.digits[t]-i.digits[t]+a,s.digits[t]=r%w,s.digits[t]<0&&(s.digits[t]+=w),a=0-Number(r<0);if(-1==a){for(t=a=0;t<e.digits.length;++t)r=0-s.digits[t]+a,s.digits[t]=r%w,s.digits[t]<0&&(s.digits[t]+=w),a=0-Number(r<0);s.isNeg=!e.isNeg}else s.isNeg=e.isNeg}return s}function O(e){for(var i=e.digits.length-1;0<i&&0==e.digits[i];)--i;return i}function S(e){var i,s=O(e),r=e.digits[s],a=(s+1)*m;for(i=a;a-m<i&&0==(32768&r);--i)r<<=1;return i}function h(e,i){for(var s,r,a,t=new A,d=O(e),n=O(i),c=0;c<=n;++c){for(s=0,a=c,j=0;j<=d;++j,++a)r=t.digits[a]+e.digits[j]*i.digits[c]+s,t.digits[a]=r&x,s=r>>>o;t.digits[c+d+1]=s}return t.isNeg=e.isNeg!=i.isNeg,t}function D(e,i){var s,r,a;result=new A,s=O(e);for(var t=r=0;t<=s;++t)a=result.digits[t]+e.digits[t]*i+r,result.digits[t]=a&x,r=a>>>o;return result.digits[1+s]=r,result}function f(e,i,s,r,a){for(var t=Math.min(i+a,e.length),d=i,n=r;d<t;++d,++n)s[n]=e[d]}var b=new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535);function U(e,i){var s=Math.floor(i/m),r=new A;f(e.digits,0,r.digits,s,r.digits.length-s);for(var a=i%m,t=m-a,d=r.digits.length-1,n=d-1;0<d;--d,--n)r.digits[d]=r.digits[d]<<a&x|(r.digits[n]&b[a])>>>t;return r.digits[0]=r.digits[d]<<a&x,r.isNeg=e.isNeg,r}var V=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);function E(e,i){var s=Math.floor(i/m),r=new A;f(e.digits,s,r.digits,0,e.digits.length-s);for(var a=i%m,t=m-a,d=0,n=d+1;d<r.digits.length-1;++d,++n)r.digits[d]=r.digits[d]>>>a|(r.digits[n]&V[a])<<t;return r.digits[r.digits.length-1]>>>=a,r.isNeg=e.isNeg,r}function z(e,i){var s=new A;return f(e.digits,0,s.digits,i,s.digits.length-i),s}function B(e,i){var s=new A;return f(e.digits,i,s.digits,0,s.digits.length-i),s}function H(e,i){var s=new A;return f(e.digits,0,s.digits,0,i),s}function L(e,i){if(e.isNeg!=i.isNeg)return 1-2*Number(e.isNeg);for(var s=e.digits.length-1;0<=s;--s)if(e.digits[s]!=i.digits[s])return e.isNeg?1-2*Number(e.digits[s]>i.digits[s]):1-2*Number(e.digits[s]<i.digits[s]);return 0}function K(e,i){var s,r,a=S(e),t=S(i),d=i.isNeg;if(a<t)return e.isNeg?((s=T(p)).isNeg=!i.isNeg,e.isNeg=!1,i.isNeg=!1,r=I(i,e),e.isNeg=!0,i.isNeg=d):(s=new A,r=T(e)),new Array(s,r);s=new A,r=e;for(var n=Math.ceil(t/m)-1,c=0;i.digits[n]<N;)i=U(i,1),++c,++t,n=Math.ceil(t/m)-1;r=U(r,c),a+=c;for(var o=Math.ceil(a/m)-1,y=z(i,o-n);-1!=L(r,y);)++s.digits[o-n],r=I(r,y);for(var v=o;n<v;--v){var l=v>=r.digits.length?0:r.digits[v],u=v-1>=r.digits.length?0:r.digits[v-1],k=v-2>=r.digits.length?0:r.digits[v-2],h=n>=i.digits.length?0:i.digits[n],g=n-1>=i.digits.length?0:i.digits[n-1];s.digits[v-n-1]=l==h?x:Math.floor((l*w+u)/h);for(var f=s.digits[v-n-1]*(h*w+g),b=l*C+(u*w+k);b<f;)--s.digits[v-n-1],f=s.digits[v-n-1]*(h*w|g),b=l*w*w+(u*w+k);(r=I(r,D(y=z(i,v-n-1),s.digits[v-n-1]))).isNeg&&(r=M(r,y),--s.digits[v-n-1])}return r=E(r,c),s.isNeg=e.isNeg!=d,e.isNeg&&(s=d?M(s,p):I(s,p),r=I(i=E(i,c),r)),0==r.digits[0]&&0==O(r)&&(r.isNeg=!1),new Array(s,r)}function q(e){this.modulus=T(e),this.k=O(this.modulus)+1;var i,s,r=new A;r.digits[2*this.k]=1,this.mu=(i=r,s=this.modulus,K(i,s)[0]),this.bkplus1=new A,this.bkplus1.digits[this.k+1]=1,this.modulo=J,this.multiplyMod=P,this.powMod=Q}function J(e){var i=B(h(B(e,this.k-1),this.mu),this.k+1),s=I(H(e,this.k+1),H(h(i,this.modulus),this.k+1));s.isNeg&&(s=M(s,this.bkplus1));for(var r=0<=L(s,this.modulus);r;)r=0<=L(s=I(s,this.modulus),this.modulus);return s}function P(e,i){var s=h(e,i);return this.modulo(s)}function Q(e,i){var s=new A;s.digits[0]=1;for(var r=e,a=i;0!=(1&a.digits[0])&&(s=this.multiplyMod(s,r)),0!=(a=E(a,1)).digits[0]||0!=O(a);)r=this.multiplyMod(r,r);return s}function R(e,i,s){this.e=k(e),this.d=k(i),this.m=k(s),this.chunkSize=2*O(this.m),this.radix=16,this.barrett=new q(this.m)}function F(e,i){for(var s=new Array,r=i.length,a=0;a<r;)s[a]=i.charCodeAt(a),a++;for(;s.length%e.chunkSize!=0;)s[a++]=0;var t,d,n,c=s.length,o="";for(a=0;a<c;a+=e.chunkSize){for(n=new A,t=0,d=a;d<a+e.chunkSize;++t)n.digits[t]=s[d++],n.digits[t]+=s[d++]<<8;var y=e.barrett.powMod(n,e.e);o+=(16==e.radix?l(y):v(y,e.radix))+" "}return o.substring(0,o.length-1)}var G,W=!1,X='<div class="security-keyboard-wrapper"><div class="security-keyboard-header"><span class="security-keyboard-title">安全键盘</span></div><div class="security-keyboard-content"><div class="security-keyboard-panel lowercase-letter-panel"><div class="security-keyboard-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-uppercase"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-delete"></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-number-and-mark">123#+=</div><div class="security-keyboard-key key-space">空格</div><div class="security-keyboard-key key-complete">完成</div></div></div><div class="security-keyboard-panel uppercase-letter-panel"><div class="security-keyboard-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-uppercase on"></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-delete"></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-number-and-mark">123#+=</div><div class="security-keyboard-key key-space">空格</div><div class="security-keyboard-key key-complete">完成</div></div></div><div class="security-keyboard-panel number-and-mark-panel"><div class="security-keyboard-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row default-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row default-row"><div class="security-keyboard-key key-mark-more">更多</div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-delete"></div></div><div class="security-keyboard-row ex-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row ex-row"><div class="security-keyboard-key key-mark-more on">更多</div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-delete"></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-letter">abc</div><div class="security-keyboard-key key-space">空格</div><div class="security-keyboard-key key-complete">完成</div></div></div><div class="security-keyboard-panel number-panel"><div class="security-keyboard-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-char"><div class="inner"></div></div></div><div class="security-keyboard-row"><div class="security-keyboard-key key-complete">完成</div><div class="security-keyboard-key key-char"><div class="inner"></div></div><div class="security-keyboard-key key-delete"></div></div></div></div></div>',Y=".security-keyboard-input-box",Z="security-keyboard-input-box-inner",$="security-keyboard-wrapper",_="focus",ee="active",ie={sendDrawInfoUrl:"sendDrawInfo",animate:!0,nameAttr:"data-name",valueAttr:"data-value",typeAttr:"data-type",defaultType:"default",sourceNameAttr:"data-source-name",defaultSourceName:"default",placeholderAttr:"data-placeholder",maxlengthAttr:"data-maxlength",keyValueAttr:"data-value",spaceKeyValue:"",onDataLoadError:function(e,i,s,r){},beforeOpen:function(){return!0},afterOpen:function(){g(document).trigger("keyboardopen")},beforeClose:function(){return!0},afterClose:function(){g(document).trigger("keyboardclose")},beforeTypeChange:function(){return!0},afterTypeChange:function(){g(document).trigger("keyboardchange")},beforeInput:function(e){return!0},onTargetChange:function(e,i){},onInput:function(){},onDelete:function(){},onComplete:function(){g(ae.target).trigger("keyboardcomplete"),fe.close(),we()}},se={},re={},ae={isOpened:!1,target:null,type:ie.defaultType},te=g.extend({},ie),de=g(X),ne=de.find(".security-keyboard-panel"),ce=de.find(".number-panel"),oe=de.find(".number-and-mark-panel"),ye=de.find(".lowercase-letter-panel"),ve=de.find(".uppercase-letter-panel");function le(i,s){var e=i===te.defaultSourceName?te.dataUrl:re[i];g.ajax({type:"post",url:e,dataType:"json",data:{method:te.sendDrawInfoUrl},success:function(e){se[i]={imageUrl:e.imageUrl,offset:function(){var e,i=[],s=[-3,-2,-1,0,1,2,3];for(e=0;e<5;e++)i.push(s[Math.ceil(6*Math.random())]);return i}(),modulus:e.modulus,exponent:e.exponent,sessionId:e.sessionId},"function"==typeof s&&s(e)},error:function(e,i,s){"function"==typeof te.onDataLoadError&&te.onDataLoadError(e,i,s,this)}})}function ue(i){if(!se[i])try{console.error("安全键盘数据源“"+i+"”获取失败")}catch(e){}for(var s=[],r=[-2,-2,-2,-2,-2],e=0;e<5;e++)s[e]=se[i].offset[e];ye.find(".key-char").each(function(){g(this).attr(te.keyValueAttr,"0."+s[0]).find(".inner").css({"background-image":"url("+se[i].imageUrl+")","background-position-y":"-75px","background-position-x":r[0]+"px"}),s[0]=s[0]+1,r[0]=r[0]-30}),ve.find(".key-char").each(function(){g(this).attr(te.keyValueAttr,"1."+s[1]).find(".inner").css({"background-image":"url("+se[i].imageUrl+")","background-position-y":"-135px","background-position-x":r[1]+"px"}),s[1]=s[1]+1,r[1]=r[1]-30}),ce.find(".key-char").each(function(){g(this).attr(te.keyValueAttr,"2."+s[2]).find(".inner").css({"background-image":"url("+se[i].imageUrl+")","background-position-y":"6px","background-position-x":r[2]+"px"}),s[2]=s[2]+1,r[2]=r[2]-50}),oe.find(".key-char").each(function(e){e<10?(g(this).attr(te.keyValueAttr,"3."+s[3]).find(".inner").css({"background-image":"url("+se[i].imageUrl+")","background-position-y":"-195px","background-position-x":r[3]+"px"}),s[3]=s[3]+1,r[3]=r[3]-30):(g(this).attr(te.keyValueAttr,"4."+s[4]).find(".inner").css({"background-image":"url("+se[i].imageUrl+")","background-position-y":"-255px","background-position-x":r[4]+"px"}),s[4]=s[4]+1,r[4]=r[4]-30)})}function ke(e){if(e){var i=g(e),s=i.attr(te.valueAttr)||"",r=i.attr(te.placeholderAttr)||"";valueLength=""===s?0:s.split(",").length,0===valueLength&&i.html(r),i.removeClass(_).trigger("keyboardblur")}}function he(e){if(""!==e&&"string"==typeof e){var i,s=g(ae.target),r=parseInt(s.attr(te.maxlengthAttr)),a=s.attr(te.valueAttr)||"",t=!1;if("function"!=typeof te.beforeInput||te.beforeInput(e)){if(i=""===a?[]:a.split(","),!isNaN(r)&&0<r){if(i.length>=r)return"function"==typeof te.onInput&&te.onInput(),s.trigger("keyboardinput"),void s.trigger("keyboardmax");i.length===r-1&&(t=!0)}i.push(e),s.attr(te.valueAttr,i.join(",")).find("."+Z).append("<b></b>"),"function"==typeof te.onInput&&te.onInput(),s.trigger("keyboardinput"),t&&s.trigger("keyboardmax")}}}function ge(e,i,s){var r,a,t=e.length/50,d=[];for(n(130),r=new R(i,"",s),a=0;a<t;a++)d.push(F(r,encodeURIComponent(e.substring(50*a,50*(a+1)))));return d.join(":")}de.on("touchstart.keyboard",function(e){e.preventDefault(),G=e.target}),de.on("touchmove.keyboard",function(e){e.preventDefault()}),de.on("touchend.keyboard",function(e){e.preventDefault(),G===e.target&&g(e.target).trigger("keyboardtap")}),de.on("touchstart.keyboard",".security-keyboard-key",function(){g(this).addClass(ee)}),de.on("touchend.keyboard",".security-keyboard-key",function(){g(this).removeClass(ee)});var fe={addSource:function(i,e){if(re[i])try{console.warn("已存在一个同名的数据源")}catch(e){}else re[i]=e,le(i,function(e){W||(g("body").append(de),W=!0),ue(i)})},getStatus:function(){return g.extend({},ae)},setType:function(e){var i,s,r;if("function"!=typeof te.beforeTypeChange||te.beforeTypeChange()){switch(i=["default","number"],s=-1!==(r=g.inArray(e+"",i))?i[r]:-1!==g.inArray(te.defaultType,i)?te.defaultType:ie.defaultType){case"default":ne.removeClass("show"),ye.addClass("show");break;case"number":ne.removeClass("show"),ce.addClass("show")}ae.type!==s&&(ae.type=s,"function"==typeof te.afterTypeChange&&te.afterTypeChange())}},open:function(e,i){var s=ae.target,r=g(e)[0];if("function"!=typeof te.beforeOpen||te.beforeOpen())if(r)r!==s&&(ae.target=r,ke(s),function(e){if(e){var i=g(e);""===(i.attr(te.valueAttr)||"")&&i.html('<div class="'+Z+'"></div>'),i.addClass(_).trigger("keyboardfocus")}}(r)),g("input:focus, textarea:focus").blur(),ue(g(r).attr(te.sourceNameAttr)||te.defaultSourceName),this.setType(g(r).attr(te.typeAttr)||""),ae.isOpened?"function"==typeof i&&i():(ae.isOpened=!0,te.animate?(de.addClass("animate"),de.height(),de.one("transitionEnd webkitTransitionEnd",function(e){e.target===this&&("function"==typeof te.afterOpen&&te.afterOpen(),r!==s&&"function"==typeof te.onTargetChange&&te.onTargetChange(s,r),"function"==typeof i&&i())}).addClass("opened")):(de.removeClass("animate"),de.height(),de.addClass("opened"),"function"==typeof te.afterOpen&&te.afterOpen(),r!==s&&"function"==typeof te.onTargetChange&&te.onTargetChange(s,r),"function"==typeof i&&i()));else try{console.error("未指定目标输入框！")}catch(e){}},close:function(i){("function"!=typeof te.beforeClose||te.beforeClose())&&(ke(ae.target),ae.target=null,ae.isOpened?te.animate&&g("input:focus,textarea:focus").length<0?(de.addClass("animate"),de.height(),de.one("transitionEnd webkitTransitionEnd",function(e){e.target===this&&(ae.isOpened=!1,"function"==typeof te.afterClose&&te.afterClose(),"function"==typeof i&&i())}).removeClass("opened")):(de.removeClass("animate"),de.height(),de.removeClass("opened"),ae.isOpened=!1,"function"==typeof te.afterClose&&te.afterClose(),"function"==typeof i&&i()):"function"==typeof i&&i())},cleanInputBox:function(e){g(void 0===e?Y:e).each(function(){var e=g(this),i=e.attr(te.placeholderAttr)||"";e.is(Y)&&(e[0]===ae.target?e.html('<div class="'+Z+'"></div>'):e.html(i),e.attr(te.valueAttr,""))})},getParamsBySourceName:function(e){return"string"==typeof e&&""!==e&&se[e]?{exponent:se[e].exponent,modulus:se[e].modulus,sessionId:se[e].sessionId}:null},encodeValueBySourceName:function(e){var s=[];return"string"==typeof e&&""!==e&&se[e]?(s.push(se[e].offset.join()),g(Y+"["+te.sourceNameAttr+"="+e+"]").each(function(e){var i=g(this);s.push(JSON.stringify({dataType:i.attr(te.typeAttr)||te.defaultType,name:i.attr(te.nameAttr)||"field",value:i.attr(te.valueAttr)||""}))}),ge(s.join(";"),se[e].exponent,se[e].modulus)):""},encodeValueByInputBox:function(e){var i,s=[],r=g(e);return r.is(Y)?(i=r.attr(te.sourceNameAttr)||te.defaultSourceName,s.push(se[i].offset.join()),s.push(JSON.stringify({dataType:r.attr(te.typeAttr)||te.defaultType,name:r.attr(te.nameAttr)||"field",value:r.attr(te.valueAttr)||""})),ge(s.join(";"),se[i].exponent,se[i].modulus)):""}};de.on("keyboardtap",".key-char",function(){he(g(this).attr(te.keyValueAttr)||"")}),de.on("keyboardtap",".key-space",function(){he(te.spaceKeyValue)}),de.on("keyboardtap",".key-delete",function(){var e,i,s;i=g(ae.target),""!==(s=i.attr(te.valueAttr)||"")&&((e=s.split(",")).pop(),i.attr(te.valueAttr,e.join(",")),i.find("."+Z).find("b").last().remove()),"function"==typeof te.onInput&&te.onInput(),"function"==typeof te.onDelete&&te.onDelete(),i.trigger("keyboardinput"),i.trigger("keyboarddelete")}),de.on("keyboardtap",".key-complete",function(){"function"==typeof te.onComplete&&te.onComplete()}),de.on("keyboardtap",".key-uppercase",function(){g(this).hasClass("on")?(ne.removeClass("show"),ye.addClass("show")):(ne.removeClass("show"),ve.addClass("show"))}),de.on("keyboardtap",".key-number-and-mark",function(){ne.removeClass("show"),oe.removeClass("ex-view").addClass("show")}),de.on("keyboardtap",".key-mark-more",function(){g(this).hasClass("on")?oe.removeClass("ex-view"):oe.addClass("ex-view")}),de.on("keyboardtap",".key-letter",function(){ne.removeClass("show"),ye.addClass("show")});var be,pe={flag:!0,length:0};function me(){var e;return g(".spacer-el-body-bottom").length<=0?(e=g('<div class="spacer-el-body-bottom" style="opacity: 0"></div>'),g("body").append(e)):e=g(".spacer-el-body-bottom"),e}function we(){var e=window["spacer-postion-fix-height"]||0,i=g(document).scrollTop(),s=g("body")[0].scrollHeight-g(window).height(),r=i-e+(window["reset-position-fix-height"]||0);r<0&&(r=0);s-r<10&&(r=s),g("html, body").animate({scrollTop:r},150);var a=setTimeout(function(){g(me()).css("height","0px"),clearTimeout(a)},150)}return g(document).on("touchstart",function(){pe.flag&&(pe.length=g("input:focus,textarea:focus").length,pe.flag=!1)}),g(document).on("click",function(e){pe.flag=!0;var i,k,h,s=g(e.target),r=s.closest(Y);if(s.is(Y)?i=e.target:0<r.length&&(i=r[0]),i){if(g(i).is("input")||g(i).is("textarea")){try{console.warn("目标不能是原生的输入框或文本域！")}catch(e){}return}pe.length?be=setTimeout(function(){fe.open(i)},300):fe.open(i),k=i,h=setTimeout(function(){var e,i,s,r,a,t=(e=g(k),i=e.outerHeight(),s=g(window).height(),r=g(document).scrollTop(),a=e.offset().top,s+r-a-i),d=t-(g(".security-keyboard-wrapper").outerHeight()||244);if(d<0){var n=g("body")[0].scrollHeight-g(window).height(),c=me(),o=g(document).scrollTop(),y=Math.ceil(Math.abs(d+n-o)),v=Math.abs(d)+4,l=v+o;c.css("height",y+50+"px"),window["spacer-postion-fix-height"]=v;var u=g(k).outerHeight()||20;window["reset-position-fix-height"]=t<20?u:0,g("html, body").animate({scrollTop:l},"2")}clearTimeout(h)},150)}}),g(document).on("click",function(e){var i=g(e.target);i.is("."+$)||0<i.parents("."+$).length||i.is(Y)||0<i.parents(Y).length||ae.isOpened&&(clearTimeout(be),fe.close(),we())}),fe});
//# sourceMappingURL=../../map/script/module/keyboard.js.map
