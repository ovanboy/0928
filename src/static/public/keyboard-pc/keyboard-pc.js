!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):t.securityKeyboard=e(jQuery)}(this,function(u){var n,s,b,c=16,m=c,N=65536,C=N>>>1,w=N*N,P=N-1;function o(t){n=new Array(t);for(var e=0;e<n.length;e++)n[e]=0;s=new A,(b=new A).digits[0]=1}o(20);t(1e15);function A(t){this.digits="boolean"==typeof t&&1==t?null:n.slice(0),this.isNeg=!1}function x(t){var e=new A(!0);return e.digits=t.digits.slice(0),e.isNeg=t.isNeg,e}function t(t){var e=new A;e.isNeg=t<0,t=Math.abs(t);for(var i=0;0<t;)e.digits[i++]=t&P,t=Math.floor(t/N);return e}function a(t){for(var e="",i=t.length-1;-1<i;--i)e+=t.charAt(i);return e}var d=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");function l(t,e){var i=new A;i.digits[0]=e;for(var n=J(t,i),r=d[n[1].digits[0]];1==E(n[0],s);)n=J(n[0],i),digit=n[1].digits[0],r+=d[n[1].digits[0]];return(t.isNeg?"-":"")+a(r)}var r=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");function g(t){var e="";for(i=0;i<4;++i)e+=r[15&t],t>>>=4;return a(e)}function f(t){for(var e="",i=(O(t),O(t));-1<i;--i)e+=g(t.digits[i]);return e}function p(t){return 48<=t&&t<=57?t-48:65<=t&&t<=90?10+t-65:97<=t&&t<=122?10+t-97:0}function h(t){for(var e=0,i=Math.min(t.length,4),n=0;n<i;++n)e<<=4,e|=p(t.charCodeAt(n));return e}function y(t){for(var e=new A,i=t.length,n=0;0<i;i-=4,++n)e.digits[n]=h(t.substr(Math.max(i-4,0),Math.min(i,4)));return e}function I(t,e){var i;if(t.isNeg!=e.isNeg)e.isNeg=!e.isNeg,i=M(t,e),e.isNeg=!e.isNeg;else{i=new A;for(var n,r=0,s=0;s<t.digits.length;++s)n=t.digits[s]+e.digits[s]+r,i.digits[s]=n%N,r=Number(N<=n);i.isNeg=t.isNeg}return i}function M(t,e){var i;if(t.isNeg!=e.isNeg)e.isNeg=!e.isNeg,i=I(t,e),e.isNeg=!e.isNeg;else{var n,r;i=new A;for(var s=r=0;s<t.digits.length;++s)n=t.digits[s]-e.digits[s]+r,i.digits[s]=n%N,i.digits[s]<0&&(i.digits[s]+=N),r=0-Number(n<0);if(-1==r){for(s=r=0;s<t.digits.length;++s)n=0-i.digits[s]+r,i.digits[s]=n%N,i.digits[s]<0&&(i.digits[s]+=N),r=0-Number(n<0);i.isNeg=!t.isNeg}else i.isNeg=t.isNeg}return i}function O(t){for(var e=t.digits.length-1;0<e&&0==t.digits[e];)--e;return e}function S(t){var e,i=O(t),n=t.digits[i],r=(i+1)*m;for(e=r;r-m<e&&0==(32768&n);--e)n<<=1;return e}function v(t,e){for(var i,n,r,s=new A,a=O(t),o=O(e),u=0;u<=o;++u){for(i=0,r=u,j=0;j<=a;++j,++r)n=s.digits[r]+t.digits[j]*e.digits[u]+i,s.digits[r]=n&P,i=n>>>c;s.digits[u+a+1]=i}return s.isNeg=t.isNeg!=e.isNeg,s}function D(t,e){var i,n,r;result=new A,i=O(t);for(var s=n=0;s<=i;++s)r=result.digits[s]+t.digits[s]*e+n,result.digits[s]=r&P,n=r>>>c;return result.digits[1+i]=n,result}function k(t,e,i,n,r){for(var s=Math.min(e+r,t.length),a=e,o=n;a<s;++a,++o)i[o]=t[a]}var U=new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535);function T(t,e){var i=Math.floor(e/m),n=new A;k(t.digits,0,n.digits,i,n.digits.length-i);for(var r=e%m,s=m-r,a=n.digits.length-1,o=a-1;0<a;--a,--o)n.digits[a]=n.digits[a]<<r&P|(n.digits[o]&U[r])>>>s;return n.digits[0]=n.digits[a]<<r&P,n.isNeg=t.isNeg,n}var B=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);function z(t,e){var i=Math.floor(e/m),n=new A;k(t.digits,i,n.digits,0,t.digits.length-i);for(var r=e%m,s=m-r,a=0,o=a+1;a<n.digits.length-1;++a,++o)n.digits[a]=n.digits[a]>>>r|(n.digits[o]&B[r])<<s;return n.digits[n.digits.length-1]>>>=r,n.isNeg=t.isNeg,n}function L(t,e){var i=new A;return k(t.digits,0,i.digits,e,i.digits.length-e),i}function V(t,e){var i=new A;return k(t.digits,e,i.digits,0,i.digits.length-e),i}function q(t,e){var i=new A;return k(t.digits,0,i.digits,0,e),i}function E(t,e){if(t.isNeg!=e.isNeg)return 1-2*Number(t.isNeg);for(var i=t.digits.length-1;0<=i;--i)if(t.digits[i]!=e.digits[i])return t.isNeg?1-2*Number(t.digits[i]>e.digits[i]):1-2*Number(t.digits[i]<e.digits[i]);return 0}function J(t,e){var i,n,r=S(t),s=S(e),a=e.isNeg;if(r<s)return t.isNeg?((i=x(b)).isNeg=!e.isNeg,t.isNeg=!1,e.isNeg=!1,n=M(e,t),t.isNeg=!0,e.isNeg=a):(i=new A,n=x(t)),new Array(i,n);i=new A,n=t;for(var o=Math.ceil(s/m)-1,u=0;e.digits[o]<C;)e=T(e,1),++u,++s,o=Math.ceil(s/m)-1;n=T(n,u),r+=u;for(var c=Math.ceil(r/m)-1,d=L(e,c-o);-1!=E(n,d);)++i.digits[c-o],n=M(n,d);for(var l=c;o<l;--l){var g=l>=n.digits.length?0:n.digits[l],f=l-1>=n.digits.length?0:n.digits[l-1],p=l-2>=n.digits.length?0:n.digits[l-2],h=o>=e.digits.length?0:e.digits[o],y=o-1>=e.digits.length?0:e.digits[o-1];i.digits[l-o-1]=g==h?P:Math.floor((g*N+f)/h);for(var v=i.digits[l-o-1]*(h*N+y),k=g*w+(f*N+p);k<v;)--i.digits[l-o-1],v=i.digits[l-o-1]*(h*N|y),k=g*N*N+(f*N+p);(n=M(n,D(d=L(e,l-o-1),i.digits[l-o-1]))).isNeg&&(n=I(n,d),--i.digits[l-o-1])}return n=z(n,u),i.isNeg=t.isNeg!=a,t.isNeg&&(i=a?I(i,b):M(i,b),n=M(e=z(e,u),n)),0==n.digits[0]&&0==O(n)&&(n.isNeg=!1),new Array(i,n)}function F(t){this.modulus=x(t),this.k=O(this.modulus)+1;var e,i,n=new A;n.digits[2*this.k]=1,this.mu=(e=n,i=this.modulus,J(e,i)[0]),this.bkplus1=new A,this.bkplus1.digits[this.k+1]=1,this.modulo=K,this.multiplyMod=Q,this.powMod=R}function K(t){var e=V(v(V(t,this.k-1),this.mu),this.k+1),i=M(q(t,this.k+1),q(v(e,this.modulus),this.k+1));i.isNeg&&(i=I(i,this.bkplus1));for(var n=0<=E(i,this.modulus);n;)n=0<=E(i=M(i,this.modulus),this.modulus);return i}function Q(t,e){var i=v(t,e);return this.modulo(i)}function R(t,e){var i=new A;i.digits[0]=1;for(var n=t,r=e;0!=(1&r.digits[0])&&(i=this.multiplyMod(i,n)),0!=(r=z(r,1)).digits[0]||0!=O(r);)n=this.multiplyMod(n,n);return i}function G(t,e,i){this.e=y(t),this.d=y(e),this.m=y(i),this.chunkSize=2*O(this.m),this.radix=16,this.barrett=new F(this.m)}function H(t,e){for(var i=new Array,n=e.length,r=0;r<n;)i[r]=e.charCodeAt(r),r++;for(;i.length%t.chunkSize!=0;)i[r++]=0;var s,a,o,u=i.length,c="";for(r=0;r<u;r+=t.chunkSize){for(o=new A,s=0,a=r;a<r+t.chunkSize;++s)o.digits[s]=i[a++],o.digits[s]+=i[a++]<<8;var d=t.barrett.powMod(o,t.e);c+=(16==t.radix?f(d):l(d,t.radix))+" "}return c.substring(0,c.length-1)}var W=!1,X=0,e='<div class="security-keyboardPC-panel" onselectstart="return!1"><div class="key-top"><label>安全键盘</label><span class="caps-lock">切换大/小写</span></div><div class="key-con"><ul></ul></div></div>',Y=".security-keyboardPC-input-box",Z="security-keyboardPC-input-box-inner",$="security-keyboardPC-panel",_="focus",tt={sendDrawInfoUrl:"sendDrawInfo",pattern:"PC",nameAttr:"data-name",valueAttr:"data-value",defaultType:"default",sourceNameAttr:"data-source-name",defaultSourceName:"default",placeholderAttr:"data-placeholder",maxlengthAttr:"data-maxlength",keyValueAttr:"data-value",onDataLoadError:function(t,e,i,n){},beforeOpen:function(){return!0},afterOpen:function(){u(document).trigger("keyboardPCOpen")},beforeClose:function(){return!0},afterClose:function(){u(document).trigger("keyboardPCClose")},onToggleCase:function(){},beforeInput:function(t){return!0},onTargetChange:function(t,e){},onInput:function(){},onDelete:function(){},onComplete:function(){u(nt.target).trigger("keyboardPCComplete"),ut.close()}},et={},it={},nt={},rt=u.extend({},tt),st=u(e);function at(t){if(t){var e=u(t),i=e.attr(rt.valueAttr)||"",n=e.attr(rt.placeholderAttr)||"";valueLength=""===i?0:i.split(",").length,0===valueLength&&e.html(n),e.removeClass(_).trigger("keyboardPCBlur")}}function ot(t,e,i){var n,r,s=t.length/50,a=[];for(o(130),n=new G(e,"",i),r=0;r<s;r++)a.push(H(n,encodeURIComponent(t.substring(50*r,50*(r+1)))));return a.join(":")}st.on("click.keyboard",function(t){t.preventDefault(),u(t.target).trigger("keyboardPCClick")});var ut={addSource:function(e,t,i){var n,r,s,a;if(it[e])try{console.warn("已存在一个同名的数据源")}catch(t){}else it[e]=t,r=i,s=function(t){W||(u("body").append(st),W=!0),function(t){if(!et[t])try{console.error("安全键盘数据源“"+t+"”获取失败")}catch(t){}for(var e=0;e<97;e++)e<95?(e<10?u(".security-keyboardPC-panel .key-con ul").append('<li class="pc-number-letter pc-key-char" data-value='+e+'><span class="pc-key-char-inner"></span></li>'):10<=e&&e<36?u(".security-keyboardPC-panel .key-con ul").append('<li class="pc-lowercase-letter pc-key-char" data-value='+e+'><span class="pc-key-char-inner"></span></li>'):36<=e&&e<62?u(".security-keyboardPC-panel .key-con ul").append('<li class="pc-uppercase-letter pc-key-char" data-value='+e+'><span class="pc-key-char-inner"></span></li>'):62<=e&&e<95&&u(".security-keyboardPC-panel .key-con ul").append('<li class="pc-mark-letter pc-key-char" data-value='+e+' ><span class="pc-key-char-inner"></span></li>'),u(".security-keyboardPC-panel .key-con ul").find("li span").eq(e).css({"background-position":X+"px 0px"}),X-=16):95==e?u(".security-keyboardPC-panel .key-con ul").append('<li class="pc-certain-btn"><a href="javascript:;">确定</a></li>'):96==e&&u(".security-keyboardPC-panel .key-con ul").append('<li class="pc-delete-btn"><a href="javascript:;">删除</a></li>');u(".security-keyboardPC-panel .key-con ul li .pc-key-char-inner").css({"background-image":"url("+et[t].imageUrl+")"}),u(".security-keyboardPC-panel .key-con ul").find(".pc-key-char").hover(function(){if(0!=u(this).find("span").length){var t=u(this).find(".pc-key-char-inner").css("background-position");(t=t.split(" "))[1]="-16px",t=t.join(" "),u(this).find("span").css("background-position",t)}},function(){if(0!=u(this).find(".pc-key-char-inner").length){var t=u(this).find(".pc-key-char-inner").css("background-position");(t=t.split(" "))[1]="0",t=t.join(" "),u(this).find(".pc-key-char-inner").css("background-position",t)}}),u(".security-keyboardPC-panel .key-top span").hover(function(){u(this).css({background:"#519dda",color:"#fff"})},function(){u(this).css({background:"#fff",color:"#519dda"})}),u(".security-keyboardPC-panel .key-con ul li").hover(function(){u(this).css({"background-position":"0px -20px;"})},function(){u(this).css({"background-position":"0px 0px;"})})}(e)},a=(n=e)===rt.defaultSourceName?rt.dataUrl:it[n],u.ajax({type:"post",url:a,dataType:"json",data:{method:rt.sendDrawInfoUrl,pattern:rt.pattern},cache:!1,async:!1,success:function(t){et[n]={imageUrl:t.imageUrl,modulus:t.modulus,exponent:t.exponent,sessionId:t.sessionId},""===et[n].imageUrl&&(et[n].imageUrl=r),"function"==typeof s&&s(t)},error:function(t,e,i){"function"==typeof rt.onDataLoadError&&rt.onDataLoadError(t,e,i,this)}})},open:function(t,e){var i=nt.target,n=u(t)[0];if("function"!=typeof rt.beforeOpen||rt.beforeOpen())if(n){if(n!==i){nt.target=n,at(i),function(t){if(t){var e=u(t);""===(e.attr(rt.valueAttr)||"")&&e.html('<div class="'+Z+'"><span></span></div>'),e.addClass(_).trigger("keyboardPCFocus")}}(n);var r=u(n).offset().top,s=u(n).offset().left,a=u(n).height(),o=parseInt(u(n).css("padding-top"));st.css({left:s+"px",top:r+a+o+"px"})}u("input:focus, textarea:focus").blur(),nt.isOpened?"function"==typeof e&&e():(nt.isOpened=!0,n!==i&&"function"==typeof rt.onTargetChange&&rt.onTargetChange(i,n),"function"==typeof e&&e(),st.addClass("keyboardPC-open"))}else try{console.error("未指定目标输入框！")}catch(t){}},close:function(t){("function"!=typeof rt.beforeClose||rt.beforeClose())&&(at(nt.target),nt.target=null,nt.isOpened&&(st.removeClass("keyboardPC-open"),nt.isOpened=!1,"function"==typeof rt.afterClose&&rt.afterClose()),"function"==typeof t&&t())},cleanInputBox:function(t){u(void 0===t?Y:t).each(function(){var t=u(this),e=t.attr(rt.placeholderAttr)||"";t.is(Y)&&(t[0]===nt.target?t.html('<div class="'+Z+'"></div>'):t.html(e),t.attr(rt.valueAttr,""))})},getParamsBySourceName:function(t){return"string"==typeof t&&""!==t&&et[t]?{exponent:et[t].exponent,modulus:et[t].modulus,sessionId:et[t].sessionId}:null},encodeValueBySourceName:function(t){var i=[];return"string"==typeof t&&""!==t&&et[t]?(u(Y+"["+rt.sourceNameAttr+"="+t+"]").each(function(t){var e=u(this);i.push(JSON.stringify({name:e.attr(rt.nameAttr)||"pwdParamter",value:e.attr(rt.valueAttr)||""}))}),ot(i.join(";"),et[t].exponent,et[t].modulus)):""},encodeValueByInputBox:function(t){var e,i=[],n=u(t);return n.is(Y)?(e=n.attr(rt.sourceNameAttr)||rt.defaultSourceName,i.push(JSON.stringify({name:n.attr(rt.nameAttr)||"pwdParamter",value:n.attr(rt.valueAttr)||""})),ot(i.join(";"),et[e].exponent,et[e].modulus)):""}};return st.on("keyboardPCClick",".caps-lock",function(){u(this).hasClass("active")?(u(".pc-uppercase-letter").hide(),u(".pc-lowercase-letter").show()):(u(".pc-lowercase-letter").hide(),u(".pc-uppercase-letter").show()),u(this).toggleClass("active"),u(nt.target).trigger("keyboardPCToggleCase")}),st.on("keyboardPCClick",".pc-certain-btn",function(){"function"==typeof rt.onComplete&&rt.onComplete()}),st.on("keyboardPCClick",".pc-delete-btn",function(){var t,e,i;e=u(nt.target),""!==(i=e.attr(rt.valueAttr)||"")&&((t=i.split(",")).pop(),e.attr(rt.valueAttr,t.join(",")),e.find("."+Z).find("b").last().remove()),"function"==typeof rt.onInput&&rt.onInput(),"function"==typeof rt.onDelete&&rt.onDelete(),e.trigger("keyboardPCInput"),e.trigger("keyboardPCDelete")}),st.on("keyboardPCClick",".pc-key-char",function(){!function(t){if(""!==t&&"string"==typeof t){var e,i=u(nt.target),n=parseInt(i.attr(rt.maxlengthAttr)),r=i.attr(rt.valueAttr)||"",s=!1;if("function"!=typeof rt.beforeInput||rt.beforeInput(t)){if(e=""===r?[]:r.split(","),!isNaN(n)&&0<n){if(e.length>=n)return"function"==typeof rt.onInput&&rt.onInput(),i.trigger("keyboardPCInput"),i.trigger("keyboardPCMax");e.length===n-1&&(s=!0)}e.push(t),i.attr(rt.valueAttr,e.join(",")).find("."+Z).append("<b></b>"),"function"==typeof rt.onInput&&rt.onInput(),i.trigger("keyboardPCInput"),s&&i.trigger("keyboardPCMax")}}}(u(this).attr(rt.keyValueAttr)||"")}),u(document).on("click",function(t){var e,i=u(t.target),n=i.closest(Y);if(i.is(Y)?e=t.target:0<n.length&&(e=n[0]),e){if(u(e).is("input")||u(e).is("textarea")){try{console.warn("目标不能是原生的输入框或文本域！")}catch(t){}return}ut.open(e)}else i.is("."+$)||0<i.parents("."+$).length||i.is(Y)||0<i.parents(Y).length||nt.isOpened&&ut.close()}),ut});
//# sourceMappingURL=../../map/script/module/keyboard-pc.js.map
